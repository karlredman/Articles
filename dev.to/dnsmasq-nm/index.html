<!DOCTYPE html>
<html class="no-js" lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="theme-color" content="#5b5b67">
	<title>Dnsmasq &#43; NetworkManager &#43; Private Network Setup | Articles</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="Dnsmasq &#43; NetworkManager &#43; Private Network Setup">
		<meta property="og:title" content="Dnsmasq &#43; NetworkManager &#43; Private Network Setup" />
<meta property="og:description" content="Dnsmasq &#43; NetworkManager &#43; Private Network Setup" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://karlredman.github.io/Articles/dev.to/dnsmasq-nm/" />
<meta property="article:published_time" content="2019-03-01T07:30:30-05:00"/>
<meta property="article:modified_time" content="2019-06-11T07:30:30-05:00"/>

		<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Dnsmasq &#43; NetworkManager &#43; Private Network Setup"/>
<meta name="twitter:description" content="Dnsmasq &#43; NetworkManager &#43; Private Network Setup"/>

	<link rel="stylesheet" href="/Articles/css/main.css">
	<link rel="stylesheet" href="/Articles/css/custom.css">
	
	<link rel="icon" href="/Articles/icons/16.png" sizes="16x16" type="image/png">
	<link rel="icon" href="/Articles/icons/32.png" sizes="32x32" type="image/png">
	<link rel="icon" href="/Articles/icons/48.png" sizes="48x48" type="image/png"><link rel="manifest" href="/Articles/manifest.json">
		
</head>
<body>
	<header class="header">
	<div class="header__inner inner">
    <a href="https://karlredman.github.io">Karl N. Redman: </a>
		<a class="logo" href="/Articles">Articles</a>
	</div>
</header>

	<div class="wrapper wrapper--flex">
	
	<section class="single">
		<article class="post block">
			<header class="post__header">
				<h1 class="post__title">Dnsmasq &#43; NetworkManager &#43; Private Network Setup</h1>
				
<div class="post__meta meta">
<time class="meta__datetime" datetime="2019-03-01T07:30:30" >March 01, 2019</time>
<time class="meta__lastmod" datetime="2019-06-11T07:30:30"> • Updated: June 11, 2019</time>
</div>

			</header>
			<div class="post__content">

<p>This is a howto/method for minimal configuration which provides a local private network that will be available to the local host for both online and offline (internet/DHCP) connectivity. The goal is to provide a scalable and network switchable development environment for virtual machines and bare metal application systems. This method intends to provide the developer the ability to roam (via laptop, et al) and maintain a consistent network development environment. Note that this configuration will require that you become accustomed to using <code>NetworkManager</code>.</p>

<ul>
<li>A TL;DR version of this article can be found <a href="https://github.com/karlredman/My-Articles/wiki/devto_tldr-dnsmasq-nm">here</a>.</li>
</ul>

<h2 id="features-of-this-howto">Features of this howto:</h2>

<ul>
<li>Reference Docker containers by name between containers.</li>
<li>Reference the host (private network) with wildcards from both the host and containers.</li>
<li>Work/develop offline or online (almost) seamlessly.</li>
<li>Reference internet hosts from docker containers (if connected -most likely DHCP).</li>
<li>Reference local host network hosts (if connected -most likely DHCP and there is a DNS running).</li>
<li>No extra configuration with <code>/etc/hosts</code></li>
<li>Ability to implement (your extended configurations):

<ul>
<li>DNS caching.</li>
<li>DHCP on a private network local to the host.</li>
<li>shared networking via NetworkManager from a host interface.</li>
<li>various VMs on the private network with full local DNS support.</li>
</ul></li>
</ul>

<h2 id="caveats-limitations">Caveats / Limitations</h2>

<ul>
<li>Your bare metal services will need to be configured for the private network (i.e. 10.127.127.1) in order to utilize &lsquo;docker container to host&rsquo; DNS resolution.</li>
<li>This procedure <em>does not</em> provide a method to resolve container hostnames from the host.</li>
<li>This procedure <em>does not</em> provide a method to resolve container hostnames from the from containers (see below for an explanation).

<ul>
<li>containers can, however, use Docker&rsquo;s internal DNS to resolve containers by container names.</li>
</ul></li>
</ul>

<h2 id="tested-systems">Tested systems:</h2>

<ul>
<li>MX Linux v18.1</li>
<li>Ubuntu v18.10</li>
<li>Debian v9.8</li>
</ul>

<h2 id="disclaimer">Disclaimer:</h2>

<p>I <strong>strongly urge</strong> that you initially test this procedure with a virtual machine. I find Virtualbox to be the easiest sandbox installation platform for desktop systems but your mileage may vary. Either way, use a spare bare metal system or a virtual machine for testing this method to see if it works for you and your environment. I am not responsible if you mess up your system, data, etc.. This information is provided as is -use at your own risk.</p>

<p>Also, I tend to write wordy howto&rsquo;s with extra information that you may not care about -as evidenced by this sentence. I&rsquo;ll try to keep that to a minimum here. ;)</p>

<h2 id="introduction">Introduction:</h2>

<p>TL;DR: Skip this part -it&rsquo;s a motivation statement&hellip;</p>

<p>Developing network-able services across the myriad virtual machine/container options (Docker, kubernetes, singularity, libvert, singularity, LXC, etc.) is challenging. An additional challenge is trying to develop these kinds of services while, as a developer, roaming between networks. For me the answer is to emulate the various network environments as closely as possible. One step toward this endeavor is to establish a basic platform whereby a single system (i.e. laptop) can roam between different network environments and maintain a consistent production-like network simulation -whether online, offline, at work, at a party, at your friends house, in a mall, on the road, or at home (etc.).</p>

<p>There are <strong>a lot</strong> of &lsquo;moving parts&rsquo; when developing any software application. That number of moving parts increases by orders of magnitude for every system resource (i.e. basic network connectivity compounds any application -add any concept of scalability and the complexity of the application dramatically increases). My attempt here is to provide a minimalist configuration whereby the reader doesn&rsquo;t have to understand how everything works <em>right now</em>. Rather, as needs for various development environments and tools become relevant, this basic network structure (hopefully) should provide a general baseline for adding emulation capabilities for future development capabilities. In the end, this howto is really simple -yet the ability to develop in a private network with a roaming system (i.e. laptop) eludes many, many developers. The moving parts to building a proper development environment become very confusing and very frustrating to many of us. It&rsquo;s overwhelming and thus, we hack&hellip;</p>

<p>I came up with this solution so that I could develop across the many virtual machine/container options on a single machine (laptop) regardless of the environment/location and the network I&rsquo;m working in. With a simple configuration of NetworkManager IP addressing + system level dnsmasq I can now create any service for any IP (on the private network) and ultimately proxypass it (with whatever proxypass tool) to my host network domain -allowing me to both provide shared services across networks and/or develop any number of combined virtual systems on an isolated system; all on a single system (laptop).</p>

<p>Hopefully this method is a step toward providing the basis of an environment which is helpful for isolated and corporate and cloud development alike.</p>

<h2 id="configure-networkmanager">Configure NetworkManager</h2>

<p>Presumably a fresh installation of various linux flavors will configure NetworkManager at installation time. The following information assumes that you have installed linux, are able to connect to the internet via DHCP, and do not have other issues pending with your network.</p>

<h3 id="add-private-network-ip-to-network-manager">Add private network ip to network manager</h3>

<p>This section implements a static ip address for the local host to use with future networks and services. All future networks on the system will use this base network -base address as configured here. To leverage this network for virtual systems you will need to identify your vitual interfaces to use this network -or otherwise configure a bridge (beyond the scope of this article).</p>

<ul>
<li><p>reference <a href="https://askubuntu.com/a/1041742">network manager - How to Add dnsmasq and keep systemd-resolved (18.04) - Ask Ubuntu</a></p></li>

<li><p>determine the connection to use (i.e. eth0, wlan0, etc.)</p>

<ul>
<li>command</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">nmcli connection show</code></pre></div>
<ul>
<li>example output</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">NAME                UUID                                  TYPE            DEVICE
Wired connection 1  xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx  802-3-ethernet  eth0
br-0a159c4a8cf4     xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx  bridge          br-0a159c4a8cf4
br-b1bce84765b8     xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx  bridge          br-b1bce84765b8
docker0             xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx  bridge          docker0</code></pre></div></li>

<li><p>add a <code>10</code> network address to our Network Manager connection</p></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">nmcli con mod <span style="color:#e6db74">&#39;Wired connection 1&#39;</span> ipv4.address <span style="color:#ae81ff">10</span>.127.127.1/24
nmcli con mod <span style="color:#e6db74">&#39;Wired connection 1&#39;</span> connection.autoconnect yes</code></pre></div>
<ul>
<li>Set the (auto) connection priority for the connection

<ul>
<li>This will force this connection to be attepted first followed by the offline (cloned) version configured below</li>
</ul></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">nmcli connection modify <span style="color:#e6db74">&#39;Wired connection 1&#39;</span> connection.autoconnect-priority -998</code></pre></div>
<ul>
<li>update connection (i.e. save the changes)</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">nmcli con up <span style="color:#e6db74">&#39;Wired connection 1&#39;</span></code></pre></div>
<ul>
<li>Note: do <em>not</em> add the new IP to your <code>/etc/hosts</code> file. A network/host name for this new address will be configured later through Dnsmasq.</li>
</ul>

<h3 id="clone-connection-and-configure">Clone connection and configure</h3>

<p>NetworkManager will hang (seemingly) indefinitely when you connect to a network that does not provide DHCP connectivity. Cloning the working connection and making some adjustments will provide the ability to work &lsquo;offline&rsquo; while maintaining the private netowrk with the system dnsmasq instance and it&rsquo;s (if configured) DHCP capabilities.</p>

<p>When a network does <em>not</em> offer DHCP capability you will use this connection to gain access to your local private network.</p>

<p>Note: switching between NetworkManager connections may require that you restart <code>dnsmasq</code>: <code>sudo service dnsmasq restart</code>. This issue occurs mostly when switching from a fully DHCP authenticated internet connection to one that is not (i.e. a connection that is not DHCP/internet enabled). In the reverse I&rsquo;ve found, rarely, a need to run <code>sudo dhclient</code> when switching from an isolated network to one that is DHCP enabled. Additionally, I&rsquo;ve had to reboot in various situations when switching from DHCP networks to non and visa versa -milage may very (sorry for the ambiguity -that&rsquo;s the state of networking&hellip;).</p>

<ul>
<li>Clone the connection</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">nmcli connection clone <span style="color:#e6db74">&#39;Wired connection 1&#39;</span> <span style="color:#e6db74">&#39;Wired connection 1 offline&#39;</span></code></pre></div>
<ul>
<li>Change cloned connection settings in favor of isolation</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">nmcli connection modify <span style="color:#e6db74">&#39;Wired connection 1 offline&#39;</span>  ipv4.method manual</code></pre></div>
<h2 id="optional-install-resolvconf">(Optional) Install resolvconf</h2>

<ul>
<li>this is a workaround for Network Manager that allows for finer grained resolver configuration</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo apt install resolvconf</code></pre></div>
<h2 id="install-and-configure-dnsmasq">Install and configure Dnsmasq</h2>

<ul>
<li>Install dnsmasq</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># uninstall network manager version of dnsmasq</span>
sudo apt remove dnsmasq-base -y

<span style="color:#75715e"># install actual dnsmasq</span>
sudo apt install dnsmasq -y</code></pre></div>
<ul>
<li>enable dnsmasq service</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo systemctl enable dnsmasq</code></pre></div>
<h2 id="configure-dnsmasq">Configure dnsmasq</h2>

<h3 id="dnsmasq-configuration-etc-dnsmasq-conf">Dnsmasq configuration <code>/etc/dnsmasq.conf</code></h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">address=/private.home/10.127.127.1
listen-address=127.0.0.1
listen-address=10.127.127.1
bind-dynamic       # could use bind-interfaces instead
domain=private.home,10.127.127.0/24
domain=docker.devnet,172.17.0.0/24</code></pre></div>
<h3 id="restart-dnsmasq-and-inspect-hosts-file">Restart Dnsmasq and inspect hosts file</h3>

<ul>
<li>restart dnsmasq service</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo service dnsmasq restart</code></pre></div>
<h2 id="reboot">!!!! <strong>REBOOT</strong> !!!!!</h2>

<p>This is a cringe worthy necessity. Just reboot, it&rsquo;s easy. Accept that the moving parts are more than you want to deal with and that it&rsquo;s really less time to just reboot. I, personally, hate this statement but &hellip; this is the state of things -accept it or spend some time finding a universal way around the reboot and report back here :D</p>

<ul>
<li>your <code>/etc/resolv.conf</code> file will look similar to this:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)</span>
<span style="color:#75715e">#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN</span>
nameserver <span style="color:#ae81ff">127</span>.0.0.1
search your-isp.net</code></pre></div>
<ul>
<li>your <code>/etc/hosts</code> file will look something like this</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">127.0.0.1	localhost
127.0.0.1   this-laptop

# The following lines are desirable for IPv6 capable hosts
::1		localhost ip6-localhost ip6-loopback
fe00::0		ip6-localnet
ff00::0		ip6-mcastprefix
ff02::1		ip6-allnodes
ff02::2		ip6-allrouters</code></pre></div>
<h2 id="test-dnsmasq">Test Dnsmasq</h2>

<h3 id="after-reboot">After reboot:</h3>

<ul>
<li><p>test local private network (should print as <code>10.127.127.1</code>)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">ping -c <span style="color:#ae81ff">4</span> private.home</code></pre></div></li>

<li><p>test google DNS (from a DHCP connected network)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">ping -c <span style="color:#ae81ff">4</span> google.com</code></pre></div></li>

<li><p>test host hostame</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">ping -c <span style="color:#ae81ff">4</span> <span style="color:#f92672">[</span>your hostname here<span style="color:#f92672">]</span></code></pre></div></li>

<li><p>test another host on the network</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">ping -c <span style="color:#ae81ff">4</span> <span style="color:#f92672">[</span>a local network hosthame here<span style="color:#f92672">]</span></code></pre></div></li>
</ul>

<h2 id="things-should-be-working-so-far">Things should be working so far&hellip;</h2>

<p>If you don&rsquo;t have responses that seem correct at this point -if something seems broken -then either this method doesn&rsquo;t work for you on your OS or you skipped a step (or I goofed and the documentation is wrong).</p>

<p>If you can&rsquo;t ping <code>private.home</code> and/or <code>google.com</code> by name then something is wrong. Please do ping 8.8.8.8 (google name server) explicitly to see if you have network access and work backwards from there. &hellip;</p>

<h2 id="add-docker-container-dns-resolution">Add Docker container DNS resolution</h2>

<p><strong>Important</strong>:</p>

<p>This section demonstrates docker container dynamic host name resolution for <em>container to container</em> and <em>container to host</em> resolution. Modern Docker container names can resolve across a bridge network -which we will create. Also, because we have established a private network, containers will be able to resolve a host&rsquo;s hostname back to our private 10.127.127.1 ip address (established earlier).</p>

<p>Note: resolving host to container hostnames is generally not required (or even considered a good idea) in production environments. The point of view is that virtual machines export ports to the host without regard for (or, more appropriately, in spite of) localhost. <code>localhost</code> in a container is not the host&rsquo;s localhost -i.e. the container&rsquo;s localhost is 127.0.0.1 within it&rsquo;s own namespace/address-space while the host&rsquo;s localhost is 127.0.0.1 relative to physical components of the host system. The container has it&rsquo;s own localhost <strong>separate</strong> from the host system.</p>

<h3 id="install-docker">install docker</h3>

<ol>
<li>do an <code>sudo apt update</code></li>
<li>download and install the <code>.deb</code> file manually (because mx linux doesn&rsquo;t natively support /etc/apt/sources.list)

<ul>
<li>reference: <a href="https://docs.docker.com/install/linux/docker-ce/debian/#install-from-a-package">get docker ce for debian | docker documentation</a></li>
<li>reference: <a href="https://download.docker.com/linux/debian/dists/stretch/pool/stable/amd64/">toplevel download path</a>

<ol>
<li><a href="https://download.docker.com/linux/debian/dists/stretch/pool/stable/amd64/docker-ce-cli_18.09.1~3-0~debian-stretch_amd64.deb">download and install docker-cli</a></li>
<li><a href="https://download.docker.com/linux/debian/dists/stretch/pool/stable/amd64/containerd.io_1.2.2-1_amd64.deb">download and install containerd.io</a>

<ul>
<li>the docker daemon will start automatically</li>
</ul></li>
<li><a href="https://download.docker.com/linux/debian/dists/stretch/pool/stable/amd64/docker-ce_18.09.1~3-0~debian-stretch_amd64.deb">download and install docker-ce</a></li>
</ol></li>
</ul></li>
<li>test docker
<code>sh
sudo docker run hello-world
</code></li>
</ol>

<h3 id="install-docker-compose">Install Docker Compose</h3>

<ul>
<li>reference <a href="https://docs.docker.com/compose/install/">Install Docker Compose</a>

<ul>
<li><a href="https://github.com/docker/compose/releases">Releases · docker/compose</a></li>
</ul></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># be sure to get the latest version (that is compatible with docker -most likely latest...)</span>
#
sudo curl -L <span style="color:#e6db74">&#34;https://github.com/docker/compose/releases/download/1.23.2/docker-compose-</span><span style="color:#66d9ef">$(</span>uname -s<span style="color:#66d9ef">)</span><span style="color:#e6db74">-</span><span style="color:#66d9ef">$(</span>uname -m<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose</code></pre></div>
<h3 id="build-an-image-for-testing">Build an image for testing</h3>

<p>This image is used for testing throughout this documentation where Docker is specified.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">git clone https://github.com/karlredman/lighttpd-docker.git
#
cd lighttpd-docker
#
sudo docker build -t lighttpd .</code></pre></div>
<h3 id="create-common-docker-network-for-containers">Create common docker network for containers</h3>

<ul>
<li><p>This section creates a common network that all <code>docekr run</code> commands and <code>docker-compose</code> instances may communicate with one another -including the ability to resolve docker container names from within the respective container instances.</p></li>

<li><p>Specify a <code>.</code> (dot) delimited network name for finicky applications that require a FQDN (fully qualified domain name).</p></li>

<li><p>Note: use <code>-</code> in names instead of <code>_</code> when possible (if needed) to maintain compatibility with various tools.</p></li>
</ul>

<pre><code>sudo docker network create docker.devnet
</code></pre>

<h3 id="add-dns-to-docker-daemon">Add DNS to Docker daemon</h3>

<ul>
<li>file /etc/docker/daemon.json</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
	<span style="color:#f92672">&#34;dns&#34;</span>: [<span style="color:#e6db74">&#34;10.127.127.1&#34;</span>, <span style="color:#e6db74">&#34;8.8.8.8&#34;</span>]
}</code></pre></div>
<ul>
<li>restart docker daemon</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo service docker restart</code></pre></div>
<h3 id="testing-host-to-docker-container-dns-resolution">Testing host to Docker container DNS resolution</h3>

<ul>
<li>Start test containers</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># start FQDN hostname docker container 1</span>
sudo docker run -d -p <span style="color:#ae81ff">8081</span>:80 -p <span style="color:#ae81ff">4441</span>:443 --rm -t --name docker-container-1-name -h docker-container-1.docker.devnet --net docker.devnet lighttpd

<span style="color:#75715e"># start container 2</span>
sudo docker run -d -p <span style="color:#ae81ff">8082</span>:80 -p <span style="color:#ae81ff">4442</span>:443 --rm -t --name docker-container-2-name -h docker-container-2 --net docker.devnet lighttpd

<span style="color:#75715e"># start container 3</span>
sudo docker run -d -p <span style="color:#ae81ff">8083</span>:80 -p <span style="color:#ae81ff">4443</span>:443 --rm -t --name docker-container-3-name -h docker-container-3 --net docker.devnet lighttpd</code></pre></div>
<ul>
<li>Test DNS resolution</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-conf" data-lang="conf">####### normal docker behavior with user-defined network &#39;docker.devnet&#39;
#
# ping container 3 *container name* from container 2
sudo docker exec -ti docker-container-2-name sh -c &#34;ping -c 4 docker-container-3-name&#34;
#
# ping private network host wildcard from a container
## Note: if this part isn&#39;t working then you likely are being blocked by your own firewall
sudo docker exec -ti docker-container-1-name sh -c &#34;ping -c 4 a-wildcard.private.home&#34;</code></pre></div>
<h2 id="that-s-it">That&rsquo;s it!</h2>

<p>I hope this workes for you&hellip;</p>
</div>
			
			<footer class="post__footer">
				


<div class="post__tags tags">
	<a class="post__tag transition" href="/Articles/tags/dnsmasq">dnsmasq</a><a class="post__tag transition" href="/Articles/tags/network-manager">network-manager</a><a class="post__tag transition" href="/Articles/tags/network">network</a><a class="post__tag transition" href="/Articles/tags/ecosystem">ecosystem</a>
</div>


				
<div class="post__share share">
	<a class="share__link" title="Share on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fkarlredman.github.io%2fArticles%2fdev.to%2fdnsmasq-nm%2f" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Share on Facebook', 'width=800,height=600,toolbar=0,status=0'); return false">
		<svg class="share__icon share__icon--facebook transition" aria-label="Facebook" role="img" width="28" height="28" viewBox="0 0 512 512"><path d="M330 512V322h64l9-74h-73v-47c0-22 6-36 37-36h39V99c-7-1-30-3-57-3-57 0-95 34-95 98v54h-64v74h64v190z"/></svg>
	</a>
	<a class="share__link" title="Share on Twitter" href="https://twitter.com/intent/tweet/?url=https%3a%2f%2fkarlredman.github.io%2fArticles%2fdev.to%2fdnsmasq-nm%2f&amp;text=Dnsmasq%20%2b%20NetworkManager%20%2b%20Private%20Network%20Setup" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Share on Twitter', 'width=800,height=450,resizable=yes,toolbar=0,status=0'); return false">
		<svg class="share__icon share__icon--twitter transition" aria-label="Twitter" role="img" width="28" height="28" viewBox="0 0 512 512"><path d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
	</a>
	<a class="share__link" title="Share on Reddit" href="https://www.reddit.com/submit?url=https%3a%2f%2fkarlredman.github.io%2fArticles%2fdev.to%2fdnsmasq-nm%2f&amp;title=Dnsmasq%20%2b%20NetworkManager%20%2b%20Private%20Network%20Setup" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Share on Reddit', 'width=832,height=624,toolbar=0,status=0'); return false">
		<svg class="share__icon share__icon--reddit transition" aria-label="Reddit" role="img" width="28" height="28" viewBox="0 0 512 512"><path fill-rule="evenodd" d="M375 146a32 32 0 1 0-29-46l-65-13c-5-1-9 2-10 6l-22 97c-45 1-85 15-113 36a42 42 0 1 0-45 69l-1 12c0 65 74 117 166 117s166-52 166-117l-1-11a42 42 0 1 0-44-69c-28-21-67-35-111-37l19-86 58 13a32 32 0 0 0 32 29zM190 353c2-1 4 0 5 1 15 11 38 18 61 18s46-6 61-18a7 7 0 0 1 8 10c-18 14-44 21-69 21-25-1-51-7-69-21a6 6 0 0 1 3-11zm23-44a31 31 0 1 1-44-44 31 31 0 0 1 44 44zm130 0a31 31 0 1 0-44-44 31 31 0 0 0 44 44z"/></svg>

	</a>
	<a class="share__link" title="Share on Telegram" href="https://t.me/share/url?url=https%3a%2f%2fkarlredman.github.io%2fArticles%2fdev.to%2fdnsmasq-nm%2f&amp;title=Dnsmasq%20%2b%20NetworkManager%20%2b%20Private%20Network%20Setup" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Share on Telegram', 'width=800,height=600,toolbar=0,status=0'); return false">
		<svg class="share__icon share__icon--telegram transition" aria-label="Telegram" role="img" width="28" height="28" viewBox="0 0 512 512"><path d="M199 404c-11 0-10-4-13-14l-32-105 245-144"/><path d="M199 404c7 0 11-4 16-8l45-43-56-34"/><path d="M204 319l135 99c14 9 26 4 30-14l55-258c5-22-9-32-24-25L79 245c-21 8-21 21-4 26l83 26 190-121c9-5 17-3 11 4"/></svg>
	</a>
	<a class="share__link transition" title="Share on LinkedIn" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fkarlredman.github.io%2fArticles%2fdev.to%2fdnsmasq-nm%2f&title=Dnsmasq%20%2b%20NetworkManager%20%2b%20Private%20Network%20Setup" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Share on LinkedIn', 'width=640,height=480,toolbar=0,status=0'); return false">
		<svg class="share__icon share__icon--linkedin transition" aria-label="LinkedIn" role="img" width="28" height="28" viewBox="0 0 512 512"><circle cx="142" cy="138" r="37"/><path stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
	</a>
	<a class="share__link transition" title="Share on VK" href="https://vk.com/share.php?url=https%3a%2f%2fkarlredman.github.io%2fArticles%2fdev.to%2fdnsmasq-nm%2f" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Share on VK', 'width=640,height=480,toolbar=0,status=0'); return false">
		<svg class="share__icon share__icon--vk transition" aria-label="VK" role="img" width="28" height="28" viewBox="0 0 512 512"><path d="M274 363c5-1 14-3 14-15 0 0-1-30 13-34s32 29 51 42c14 9 25 8 25 8l51-1s26-2 14-23c-1-2-9-15-39-42-31-30-26-25 11-76 23-31 33-50 30-57-4-7-20-6-20-6h-57c-6 0-9 1-12 6 0 0-9 25-21 45-25 43-35 45-40 42-9-5-7-24-7-37 0-45 7-61-13-65-13-2-59-4-73 3-7 4-11 11-8 12 3 0 12 1 17 7 8 13 9 75-2 81-15 11-53-62-62-86-2-6-5-7-12-9H79c-6 0-15 1-11 13 27 56 83 193 184 192z"/></svg>
	</a>
	<a class="share__link transition" title="Save on Pocket" href="https://getpocket.com/edit?url=https%3a%2f%2fkarlredman.github.io%2fArticles%2fdev.to%2fdnsmasq-nm%2f&amp;title=Dnsmasq%20%2b%20NetworkManager%20%2b%20Private%20Network%20Setup" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Save on Pocket', 'width=480,height=320,toolbar=0,status=0'); return false">
		<svg class="share__icon share__icon--pocket transition" aria-label="Pocket" role="img" width="28" height="28" viewBox="0 0 512 512"><path d="M388.8 88.9H123.2A47.4 47.4 0 0 0 76 136.5v131.9c0 2.4.2 4.8.5 7.2a101.8 101.8 0 0 0-.5 10.6c0 75.6 80.6 137 180 137s180-61.4 180-137c0-3.6-.2-7.1-.5-10.6.3-2.4.5-4.8.5-7.2v-132A47.4 47.4 0 0 0 388.8 89zm-22.4 132.6l-93 93c-4.7 4.6-11 7-17.1 7a23.8 23.8 0 0 1-17.7-7l-93-93a24 24 0 0 1 33.8-33.8l76.6 76.5 76.6-76.5a24 24 0 0 1 33.8 33.8z"/></svg>
	</a>
</div>
			</footer>
			
		</article>
		
		
	</section>
	
<section class="sidebar
		 sidecards">
	
	
<div class="sidecard">
	<div class="widget widget-categories block">
		<h3 class="widget__title">Categories</h3>
		<div class="widget__content">
			<ul class="widget__list">
				<li class="widget__item"><a class="widget__link" href="/Articles/categories/admin">Admin</a></li>
				<li class="widget__item"><a class="widget__link" href="/Articles/categories/advice">Advice</a></li>
				<li class="widget__item"><a class="widget__link" href="/Articles/categories/article">Article</a></li>
				<li class="widget__item"><a class="widget__link" href="/Articles/categories/auth">Auth</a></li>
				<li class="widget__item"><a class="widget__link" href="/Articles/categories/development">Development</a></li>
				<li class="widget__item"><a class="widget__link" href="/Articles/categories/docker">Docker</a></li>
				<li class="widget__item"><a class="widget__link" href="/Articles/categories/ecosystem">Ecosystem</a></li>
				<li class="widget__item"><a class="widget__link" href="/Articles/categories/howto">Howto</a></li>
				<li class="widget__item"><a class="widget__link" href="/Articles/categories/linux">Linux</a></li>
				<li class="widget__item"><a class="widget__link" href="/Articles/categories/network">Network</a></li>
				<li class="widget__item"><a class="widget__link" href="/Articles/categories/programming">Programming</a></li>
				<li class="widget__item"><a class="widget__link" href="/Articles/categories/shortcuts">Shortcuts</a></li>
				<li class="widget__item"><a class="widget__link" href="/Articles/categories/utility">Utility</a></li>
				<li class="widget__item"><a class="widget__link" href="/Articles/categories/vscode">Vscode</a></li>
				<li class="widget__item"><a class="widget__link" href="/Articles/categories/web">Web</a></li>
			</ul>
		</div>
	</div>
</div>
	
<div class="sidecard">
	<div class="widget widget-tags block">
		<h3 class="widget__title">Tags</h3>
		<div class="widget-tags__content widget__content">
			<a class="widget-tags__link widget__link transition" href="/Articles/tags/8.1" title="8.1">8.1 (1)</a>
			<a class="widget-tags__link widget__link transition" href="/Articles/tags/administration" title="Administration">Administration (2)</a>
			<a class="widget-tags__link widget__link transition" href="/Articles/tags/authentication" title="Authentication">Authentication (1)</a>
			<a class="widget-tags__link widget__link transition" href="/Articles/tags/compile" title="Compile">Compile (1)</a>
			<a class="widget-tags__link widget__link transition" href="/Articles/tags/development" title="Development">Development (1)</a>
			<a class="widget-tags__link widget__link transition" href="/Articles/tags/diagram" title="Diagram">Diagram (2)</a>
			<a class="widget-tags__link widget__link transition" href="/Articles/tags/dnsmasq" title="Dnsmasq">Dnsmasq (2)</a>
			<a class="widget-tags__link widget__link transition" href="/Articles/tags/docker" title="Docker">Docker (1)</a>
			<a class="widget-tags__link widget__link transition" href="/Articles/tags/ecosystem" title="Ecosystem">Ecosystem (3)</a>
			<a class="widget-tags__link widget__link transition" href="/Articles/tags/flowchart" title="Flowchart">Flowchart (1)</a>
			<a class="widget-tags__link widget__link transition" href="/Articles/tags/front-matter" title="Front matter">Front matter (1)</a>
			<a class="widget-tags__link widget__link transition" href="/Articles/tags/gatekeeper" title="Gatekeeper">Gatekeeper (2)</a>
			<a class="widget-tags__link widget__link transition" href="/Articles/tags/howto" title="Howto">Howto (1)</a>
			<a class="widget-tags__link widget__link transition" href="/Articles/tags/jinja2" title="Jinja2">Jinja2 (1)</a>
			<a class="widget-tags__link widget__link transition" href="/Articles/tags/keycloak" title="Keycloak">Keycloak (3)</a>
			<a class="widget-tags__link widget__link transition" href="/Articles/tags/lifestyle" title="Lifestyle">Lifestyle (1)</a>
			<a class="widget-tags__link widget__link transition" href="/Articles/tags/markdown" title="Markdown">Markdown (1)</a>
			<a class="widget-tags__link widget__link transition" href="/Articles/tags/mental-health" title="Mental health">Mental health (1)</a>
			<a class="widget-tags__link widget__link transition" href="/Articles/tags/navigation" title="Navigation">Navigation (1)</a>
			<a class="widget-tags__link widget__link transition" href="/Articles/tags/network" title="Network">Network (3)</a>
			<a class="widget-tags__link widget__link transition" href="/Articles/tags/network-manager" title="Network manager">Network manager (2)</a>
			<a class="widget-tags__link widget__link transition" href="/Articles/tags/programming" title="Programming">Programming (1)</a>
			<a class="widget-tags__link widget__link transition" href="/Articles/tags/python3" title="Python3">Python3 (1)</a>
			<a class="widget-tags__link widget__link transition" href="/Articles/tags/shortcuts" title="Shortcuts">Shortcuts (1)</a>
			<a class="widget-tags__link widget__link transition" href="/Articles/tags/traefik" title="Traefik">Traefik (1)</a>
			<a class="widget-tags__link widget__link transition" href="/Articles/tags/vim" title="Vim">Vim (2)</a>
			<a class="widget-tags__link widget__link transition" href="/Articles/tags/vscode" title="Vscode">Vscode (1)</a>
		</div>
	</div>
</div>
</section>


	</div>
	<footer class="footer">
	<div class="footer__inner inner">
		<div class="footer__copyright">© 2019 Articles. <span class="footer__copyright-credits">Powered by <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/vimux/amnix" rel="nofollow noopener" target="_blank">Amnix</a> theme.</span></div>
<div class="footer__social social">
		<a class="social__link transition" target="_blank" rel="noopener noreferrer" href="mailto:karl.redman@gmail.com">
			<svg class="social__icon" aria-label="Email" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M299 268l124 106c-4 4-10 7-17 7H106c-7 0-13-3-17-7l124-106 43 38 43-38zm-43 13L89 138c4-4 10-7 17-7h300c7 0 13 3 17 7L256 281zm54-23l121-105v208L310 258zM81 153l121 105L81 361V153z"/></svg>
		</a>
		<a class="social__link transition" target="_blank" rel="noopener noreferrer" href="https://twitter.com/Karl_Redman">
			<svg class="social__icon" aria-label="Twitter" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
		</a>
		<a class="social__link transition" target="_blank" rel="noopener noreferrer" href="https://linkedin.com/in/karl-n-redman-850413">
			<svg class="social__icon" aria-label="LinkedIn" role="img" width="32" height="32" viewBox="0 0 512 512"><circle cx="142" cy="138" r="37"/><path stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
		</a>
		<a class="social__link transition" target="_blank" rel="noopener noreferrer" href="https://github.com/karlredman">
			<svg class="social__icon" aria-label="GitHub" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
		</a>
		<a class="social__link transition" target="_blank" rel="noopener noreferrer" href="https://gitlab.com/karl.redman">
			<svg class="social__icon" aria-label="GitLab" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M450 282l-22-67-43-133c-2-7-12-7-14 0l-43.3 133H184.3L141 82c-2-7-12-7-14 0L84 215l-22 67c-2 6 0 13 6 16l188 137 188-137c6-3 8-10 6-16z"/></svg>
		</a>
		<a class="social__link transition" target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/users/1725771">
			<svg class="social__icon" aria-label="Stack Overflow" role="img" width="32" height="32" viewBox="0 0 512 512"><g stroke-width="30"><path fill="none" d="M125 297v105h241V297"/><path d="M170 341h150m-144-68l148 31M199 204l136 64m-95-129l115 97M293 89l90 120"/></g></svg>
		</a>
		<a class="social__link transition" target="_blank" rel="noopener noreferrer" href="https://medium.com/@karl.redman">
			<svg class="social__icon" aria-label="Medium" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M125 173c0-4-2-9-5-11l-31-38v-6h98l75 166 67-166h93v6l-27 26c-2 1-3 4-3 7v190c0 3 1 6 3 8l27 25v6H289v-6l27-26c3-3 3-4 3-8V193l-76 192h-10l-88-192v129c-1 5 1 11 5 15l35 43v5H85v-5l35-43c4-4 6-10 5-15z"/></svg>
		</a>
</div>
	</div>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
</body>
</html>